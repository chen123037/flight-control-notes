# 第 4 周学习记录 - 坐标系可视化与传感器基础

> 阶段 1 · 第 2 个月 · 第 1 周
> 日期：2026-02-09（周一）至 2026-02-13（周五）
> 周末休息

---

## 计划调整说明

**原计划**：坐标系与姿态表示 → 《坐标系变换笔记》+ Python 可视化代码

**调整原因**：
- 第 2 周已学完《小型无人机》第 4-5 章，书籍进度超前
- 坐标系与姿态理论（书籍第 2-3 章）已在书中学过
- 第 3 周插入了信号与系统基础学习（拉普拉斯变换、传递函数）
- 需要保持书籍学习的连贯性

**调整后**：
- 📖 继续学习《小型无人机》**第 6 章：传感器与测量**
- 📖 完成《小型无人机》**第 5 章剩余部分**（传递函数模型 5.4 节起）
- 🐍 完成 **Python 坐标系/姿态可视化代码**（原计划产出）
- 📄 整理《坐标系变换笔记》（结合已学内容）

---

## 本周目标

**核心产出**：《坐标系变换笔记》+ Python 可视化代码

| 检查项 | 完成 |
|--------|------|
| [ ] 《坐标系变换笔记》完成 | |
| [ ] Python 坐标系可视化代码 | |
| [ ] Python 姿态（欧拉角/四元数）可视化 | |
| [ ] 《小型无人机》第 5 章完成（5.4 节起） | |
| [ ] 《小型无人机》第 6 章阅读完成 | |
| [ ] 传感器特性笔记整理 | |
| [ ] **SITL 实践：观察姿态与传感器数据** | |

---

## 每日计划与记录

### 周一 2/9 - 完成第5章 + 坐标系理论整理

**理论任务**：
- 完成《小型无人机》第 5 章剩余部分（5.4 传递函数模型起）
- 整理书籍第 2 章内容（坐标系定义）
- 开始阅读第 6 章（传感器概述）

**重点内容**：
| 坐标系 | 符号 | 原点 | 用途 |
|--------|------|------|------|
| 惯性系（NED） | $\mathcal{F}^i$ | 地面固定点 | 导航计算 |
| 机体系 | $\mathcal{F}^b$ | 飞机重心 | 力/力矩分析 |
| 稳定系 | $\mathcal{F}^s$ | 飞机重心 | 气动分析 |
| 风轴系 | $\mathcal{F}^w$ | 飞机重心 | 升阻力分析 |

**书籍第 6 章主要内容**：
- 传感器类型与特性
- 陀螺仪建模
- 加速度计建模
- 气压高度计
- GPS 建模
- 空速传感器

**🛩️ SITL 实践（今日）**：
1. 启动 SITL：`cd ~/ardupilot/ArduPlane && sim_vehicle.py --console --map`
2. Mission Planner 连接后，进入 **Flight Data → Status** 页面
3. 观察**静止时**各传感器读数并记录：

| 数据项 | 含义 | 静止时读数 |
|--------|------|------------|
| `ax`, `ay`, `az` | 加速度计 | 记录：______ |
| `xgyro`, `ygyro`, `zgyro` | 陀螺仪 | 记录：______ |
| `xmag`, `ymag`, `zmag` | 磁力计 | 记录：______ |

4. 思考：静止时 `az` 为什么不是 0？（提示：重力）

**产出**：第5章完成笔记 + 坐标系定义笔记 + 第6章阅读笔记 + SITL 静止传感器数据截图

**记录**：
```
学习时长：__ 小时
完成情况：
SITL 实践完成：[ ]
遇到问题：
```

---

### 周二 2/10 - 旋转矩阵与欧拉角

**理论任务**：
- 整理书籍第 3 章内容（姿态表示）
- 推导旋转矩阵
- 理解欧拉角与万向锁

**重点公式**：

**基本旋转矩阵**：
```
R_x(φ) = [1,    0,      0   ]    滚转
         [0,  cos(φ), sin(φ)]
         [0, -sin(φ), cos(φ)]

R_y(θ) = [cos(θ), 0, -sin(θ)]    俯仰
         [  0,    1,    0   ]
         [sin(θ), 0,  cos(θ)]

R_z(ψ) = [ cos(ψ), sin(ψ), 0]    偏航
         [-sin(ψ), cos(ψ), 0]
         [   0,      0,    1]
```

**机体系到惯性系旋转**：
```
R_b^i = R_z(ψ) × R_y(θ) × R_x(φ)
```

**书籍第 6 章继续**：
- 陀螺仪误差模型
- 加速度计误差模型

**🛩️ SITL 实践（今日）**：
1. 启动 SITL + Mission Planner
2. 切换到 **Manual 模式**（Flight Data → Actions → Set Mode → Manual）
3. 在 Status 页面观察 `roll`, `pitch`, `yaw` 数据
4. 用键盘或摇杆控制飞机，观察欧拉角变化：

| 操作 | 观察数据 | 预期方向 | 变化记录 |
|------|----------|----------|----------|
| 向右压杆（右滚） | `roll` | 正值增大 | 记录：______ |
| 向左压杆（左滚） | `roll` | 负值减小 | 记录：______ |
| 向后拉杆（抬头） | `pitch` | 正值增大 | 记录：______ |
| 向右打舵（右偏航） | `yaw` | 正值增大 | 记录：______ |

5. 验证 ArduPilot 姿态约定：
   - `roll` 正值 = 右翼下沉（右滚）
   - `pitch` 正值 = 机头抬起（抬头）
   - `yaw` 正值 = 机头右转（顺时针）

**产出**：旋转矩阵推导笔记 + 传感器误差模型笔记 + SITL 欧拉角变化截图

**记录**：
```
学习时长：__ 小时
完成情况：
SITL 实践完成：[ ]
遇到问题：
```

---

### 周三 2/11 - 四元数与姿态转换 + 传感器融合概念

**理论任务**：
- 学习四元数表示姿态
- 理解四元数与旋转矩阵的转换
- 了解传感器融合的必要性

**四元数基础**：
```
q = [q0, q1, q2, q3]^T = [cos(θ/2), e·sin(θ/2)]^T

其中 e 是旋转轴单位向量，θ 是旋转角度
```

**四元数优势**：
1. 无万向锁问题
2. 计算效率高（4个参数 vs 9个矩阵元素）
3. 插值平滑（SLERP）

**书籍第 6 章重点**：
- 为什么需要多传感器融合
- 各传感器的互补特性（陀螺短期准、加速度计长期准）

**🛩️ SITL 实践（今日）**：
1. 启动 SITL + Mission Planner
2. 进入 **Flight Data → Status** 页面
3. 让飞机做一个动作（如滚转），同时观察：

| 传感器 | 数据项 | 变化特点 |
|--------|--------|----------|
| 陀螺仪 | `rollspeed` | 记录：______ |
| 加速度计 | `ax`, `ay`, `az` | 记录：______ |

4. 对比陀螺仪读数（角速度）与 `rollspeed`（理论角速度）
5. 思考：
   - 陀螺仪测量的是什么？（角速度）
   - 加速度计静止时测量的是什么？（重力）
   - 为什么需要两者融合？

**产出**：四元数笔记 + 传感器融合概念笔记 + SITL 陀螺仪/加速度计对比记录

**记录**：
```
学习时长：__ 小时
完成情况：
SITL 实践完成：[ ]
遇到问题：
```

---

### 周四 2/12 - Python 坐标系可视化实现

**理论任务**：
- 实现 3D 坐标系可视化
- 实现旋转矩阵动画
- 实现欧拉角变化演示

**代码结构**：
```python
code/coordinate_visualization/
├── coordinate_systems.py    # 坐标系定义与绘制
├── rotation_matrix.py       # 旋转矩阵计算
├── euler_angles.py          # 欧拉角演示
├── quaternion.py            # 四元数演示
├── mavlink_reader.py        # 读取 SITL 实时数据
└── demo.py                  # 综合演示
```

**核心功能**：
1. 绘制 NED 坐标系
2. 绘制机体坐标系
3. 动画展示旋转过程
4. 演示万向锁现象

**推荐库**：
- `matplotlib` + `mpl_toolkits.mplot3d`
- `numpy` 矩阵运算
- `matplotlib.animation` 动画
- `pymavlink` 读取 SITL 数据

**🛩️ SITL 实践（今日）- 用 Python 读取实时姿态**：

1. 安装 pymavlink：`pip install pymavlink`

2. **重要**：SITL 启动时会输出多个端口，选择一个 Mission Planner 未占用的端口：
   - 14550：通常被 Mission Planner 占用
   - **14551**：备用端口，推荐 Python 使用

3. 启动 SITL（保持运行），**关闭 Mission Planner** 或使用 14551 端口

4. 运行以下代码读取实时姿态：

```python
# mavlink_reader.py
from pymavlink import mavutil
import time

# 连接 SITL
# 方式1：如果关闭了 Mission Planner，用 14550
# conn = mavutil.mavlink_connection('udp:127.0.0.1:14550')

# 方式2：如果 Mission Planner 在用 14550，用 14551
conn = mavutil.mavlink_connection('udp:127.0.0.1:14551')

print("等待心跳...")
conn.wait_heartbeat()
print(f"已连接: system {conn.target_system}, component {conn.target_component}")

# 读取姿态数据
print("\n实时姿态数据（Ctrl+C 退出）：")
while True:
    msg = conn.recv_match(type='ATTITUDE', blocking=True, timeout=1)
    if msg:
        roll_deg = msg.roll * 57.2958  # rad -> deg
        pitch_deg = msg.pitch * 57.2958
        yaw_deg = msg.yaw * 57.2958
        print(f"Roll: {roll_deg:7.2f}°  Pitch: {pitch_deg:7.2f}°  Yaw: {yaw_deg:7.2f}°")
    time.sleep(0.1)
```

5. 如果连接失败，尝试以下排查：
   - 检查 SITL 是否输出了其他端口号
   - 尝试 `udp:localhost:14551` 或 `tcp:127.0.0.1:5760`

6. 在 SITL 中手动控制飞机，观察 Python 输出是否与 Mission Planner 一致

**产出**：Python 坐标系可视化代码 + mavlink_reader.py

**记录**：
```
学习时长：__ 小时
完成情况：
SITL 实践完成：[ ]
pymavlink 读取成功：[ ]
遇到问题：
```

---

### 周五 2/13 - Python 姿态可视化 + 整理

**理论任务**：
- 实现姿态（飞机模型）可视化
- 实现欧拉角/四元数切换
- 整理本周笔记和代码

**可视化效果**：
```
   ↑ Z (Down)
   │
   │    ╱╲
   │   ╱  ╲   ← 飞机简化模型
   │  ╱────╲
   │
   └──────────→ X (North)
  ╱
 ╱
Y (East)
```

**🛩️ SITL 实践（今日）- 验证理论与数据一致性**：

1. 启动 SITL + Mission Planner
2. 完成以下验证任务并截图：

| 验证项 | 理论预期 | 实际数据 | 一致？ |
|--------|----------|----------|--------|
| 静止时 `az` | ≈ **+9.8** (NED 坐标系 Z 向下为正，重力方向) | ______ | [ ] |
| 右滚时 `rollspeed` | > 0 (右滚角速度为正) | ______ | [ ] |
| 抬头时 `pitchspeed` | > 0 (抬头角速度为正) | ______ | [ ] |
| 右转时 `yawspeed` | > 0 (右偏航角速度为正) | ______ | [ ] |

**注意**：NED 坐标系中 Z 轴向下为正，所以静止时加速度计测量的重力加速度 `az ≈ +9.8 m/s²`

3. 截图保存到 `docs/06-实践记录/SITL/第04周-传感器数据验证/`

4. 整理本周所有 SITL 实践截图和记录

**产出要求**：
1. 《坐标系变换笔记》完整版
2. Python 可视化代码（可运行）
3. 传感器基础笔记（第6章）
4. **SITL 实践截图汇总**

**记录**：
```
学习时长：__ 小时
完成情况：
SITL 实践完成：[ ]
理论与数据一致性验证：[ ]
遇到问题：
```

---

### 周六 2/14 & 周日 2/15 - 休息

休息日，可选择性复习或继续阅读书籍

---

## 本周产出物

### 1. 坐标系变换笔记

存放位置：`docs/02-基础知识/坐标系变换.md`

**目录结构**：
```
# 坐标系变换笔记

## 1. 坐标系定义
### 1.1 惯性坐标系（NED）
### 1.2 机体坐标系
### 1.3 稳定坐标系
### 1.4 风轴坐标系

## 2. 旋转表示
### 2.1 旋转矩阵
### 2.2 欧拉角（ZYX顺序）
### 2.3 四元数

## 3. 坐标变换
### 3.1 机体系 ↔ 惯性系
### 3.2 角速度变换

## 4. 万向锁问题与解决

## 附录：Python 代码说明
```

### 2. Python 可视化代码

存放位置：`code/coordinate_visualization/`

### 3. 传感器基础笔记

存放位置：`docs/02-基础知识/传感器基础.md`

---

## 书籍阅读进度

### 《小型无人机理论与控制》

| 章节 | 内容 | 状态 |
|------|------|------|
| 第1章 | 引言 | ✅ 已完成 |
| 第2章 | 坐标系 | ✅ 已完成 |
| 第3章 | 运动学与动力学 | ✅ 已完成 |
| 第4章 | 力与力矩 | ✅ 已完成 |
| 第5章 | 气动系数估计 | **本周完成**（5.4节起） |
| **第6章** | **传感器与测量** | **本周进行** |
| 第7章 | 状态估计 | 第4个月 |
| 第8章 | 扩展卡尔曼滤波 | 第4个月 |

### 关于《现代控制理论》

**建议**：
- 本周不系统学习《现代控制理论》
- 在第 2 个月"控制理论实践"时再深入
- 当前可作为参考书，遇到问题时按需查阅

**原因**：
1. 当前学习节奏良好，书籍进度超前
2. 《小型无人机》第 6-8 章与阶段1后半程计划衔接更紧密
3. 《现代控制理论》更适合在 PID/LQR 深入学习时配合阅读

---

## 本周学习资源

### 书籍
- 《小型无人机理论与控制》第 5 章（完成）+ 第 6 章
- 《小型无人机理论与控制》第 2-3 章（复习）

### 在线资源
- 3Blue1Brown 四元数可视化：https://www.youtube.com/watch?v=d4EgbgTm0Bg
- ArduPilot 坐标系文档

### Python 库
- `numpy`：矩阵运算
- `matplotlib`：3D 可视化
- `scipy.spatial.transform.Rotation`：旋转变换工具

---

## 周总结（周六填写）

### 完成情况
- [ ] 《小型无人机》第 5 章完成
- [ ] 《坐标系变换笔记》
- [ ] Python 可视化代码
- [ ] 《小型无人机》第 6 章
- [ ] 传感器基础笔记
- [ ] **SITL 实践：静止传感器数据观察**（周一）
- [ ] **SITL 实践：欧拉角变化观察**（周二）
- [ ] **SITL 实践：陀螺仪/加速度计对比**（周三）
- [ ] **SITL 实践：pymavlink 读取姿态**（周四）
- [ ] **SITL 实践：理论与数据一致性验证**（周五）

### 主要收获
1.
2.
3.

### 遇到的问题
1.
2.

### 对下周的建议
-

### 自我评价

| 项目 | 评分(1-5) |
|------|-----------|
| 产出质量 | |
| 学习效率 | |
| 理解深度 | |

---

*第4周学习记录 - 待完成*
