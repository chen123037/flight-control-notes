# 阶段 2：多旋翼原理（8 个月）

> 目标：深入理解多旋翼控制原理与 ArduPilot 架构

---

## 阶段目标

完成本阶段后，你应该能够：

1. ✅ 推导四旋翼的完整动力学模型
2. ✅ 理解并实现卡尔曼滤波器
3. ✅ 深入理解 ArduCopter 的控制架构
4. ✅ 能够修改 ArduPilot 源码并测试
5. ✅ 理解控制分配（Control Allocation）原理
6. ✅ 完成四旋翼仿真调参

---

## 月度计划

### 第 1-2 个月：控制理论深入

#### 学习内容

| 周 | 主题 | 具体内容 | 产出 |
|---|------|----------|------|
| 1 | 状态空间(1) | 状态方程、状态转移矩阵 | 推导笔记 |
| 2 | 状态空间(2) | 可控性、可观性 | 推导笔记 |
| 3 | 极点配置 | 状态反馈、极点配置设计 | 仿真实验 |
| 4 | LQR 入门 | 最优控制基础、LQR 设计 | 仿真实验 |
| 5-6 | 非线性控制入门 | 李雅普诺夫稳定性 | 理论笔记 |
| 7-8 | 控制器实现 | 用 Python/C++ 实现 LQR | 代码实现 |

#### 书籍阅读
- 📖 **《现代控制工程》Ogata** 第6-10章
- 📖 **《Feedback Control of Dynamic Systems》** 选读

#### 考核任务
- [ ] 手写推导 LQR 的最优解
- [ ] 用 Python 实现 LQR 控制器控制倒立摆仿真
- [ ] 解释可控性和可观性的物理含义

---

### 第 3-4 个月：状态估计与传感器融合

#### 学习内容

| 周 | 主题 | 具体内容 | 产出 |
|---|------|----------|------|
| 1 | 概率论复习 | 随机变量、高斯分布、协方差 | 笔记 |
| 2 | 卡尔曼滤波(1) | 线性卡尔曼滤波推导 | 推导笔记 |
| 3 | 卡尔曼滤波(2) | KF 代码实现、参数调节 | 代码实现 |
| 4 | 扩展卡尔曼滤波 | EKF 原理、雅可比矩阵 | 推导笔记 |
| 5 | EKF 实现 | 用 Python 实现 EKF | 代码实现 |
| 6 | 传感器融合 | IMU + GPS 融合原理 | 仿真实验 |
| 7 | ArduPilot EKF | 分析 AP_NavEKF3 代码 | 分析报告 |
| 8 | 综合实践 | 实现简单的姿态估计器 | 项目代码 |

#### 书籍阅读
- 📖 **《Kalman Filter for Beginners》** Phil Kim - 全书
- 📖 **《Probabilistic Robotics》** 第2-3章（选读）

#### 考核任务
- [ ] 手写推导卡尔曼滤波的五个公式
- [ ] 用 Python 实现 EKF 进行姿态估计
- [ ] 解释 ArduPilot 中 EKF 的主要状态变量

---

### 第 5-6 个月：四旋翼建模与控制

#### 学习内容

| 周 | 主题 | 具体内容 | 产出 |
|---|------|----------|------|
| 1 | 四旋翼结构 | 机械结构、电机布局 | 知识图谱 |
| 2 | 动力学建模(1) | 牛顿-欧拉方程 | 推导笔记 |
| 3 | 动力学建模(2) | 力和力矩计算 | 推导笔记 |
| 4 | 控制分配 | 电机混控、分配矩阵 | 代码实现 |
| 5 | 姿态控制 | 内环控制器设计 | 仿真实验 |
| 6 | 位置控制 | 外环控制器设计 | 仿真实验 |
| 7 | 完整仿真 | 四旋翼完整仿真系统 | 仿真代码 |
| 8 | ArduCopter 分析 | 分析 ArduCopter 控制代码 | 分析报告 |

#### 书籍阅读
- 📖 **《Small Unmanned Aircraft》** 第6-10章
- 📖 **四旋翼相关论文**（推荐 Mahony 的经典论文）

#### 考核任务
- [ ] 推导四旋翼的 12 状态动力学方程
- [ ] 用 Python 实现完整的四旋翼仿真
- [ ] 画出 ArduCopter 的控制架构图

---

### 第 7-8 个月：ArduCopter 深入与综合

#### 学习内容

| 周 | 主题 | 具体内容 | 产出 |
|---|------|----------|------|
| 1 | ArduCopter 架构 | 代码结构、调度系统 | 架构图 |
| 2 | 姿态控制器 | AC_AttitudeControl 分析 | 代码分析 |
| 3 | 位置控制器 | AC_PosControl 分析 | 代码分析 |
| 4 | 飞行模式 | 各模式实现分析 | 模式对比 |
| 5 | SITL 调参 | ArduCopter SITL 调参实践 | 调参日志 |
| 6 | 代码修改 | 尝试修改并测试 | 修改记录 |
| 7 | 综合项目 | 完成一个调参优化任务 | 项目报告 |
| 8 | 阶段总结 | 知识回顾、准备阶段3 | 总结报告 |

#### 考核任务
- [ ] 完成阶段 2 综合考核
- [ ] 能够独立修改 ArduCopter 参数并验证效果
- [ ] 撰写 ArduCopter 控制系统分析报告

---

## 阶段 2 综合考核

### 理论考核

1. 推导四旋翼的动力学方程（从牛顿-欧拉法开始）
2. 推导卡尔曼滤波的预测和更新公式
3. 解释 LQR 和 PID 的区别与联系
4. 解释 ArduPilot 中的级联控制结构
5. 什么是控制分配？画出四旋翼的控制分配矩阵

### 实践考核

1. **仿真任务**：用 Python 实现四旋翼仿真，包含姿态和位置控制
2. **代码任务**：修改 ArduCopter 的一个控制参数，验证效果
3. **分析任务**：分析 ArduCopter 的一个飞行模式实现

---

## 关键知识点

### 四旋翼动力学方程框架

```
状态向量 x = [x, y, z, φ, θ, ψ, u, v, w, p, q, r]^T
         = [位置, 姿态, 线速度, 角速度]

动力学方程：
ẋ = f(x, u)  // 非线性状态方程
其中 u = [ω1, ω2, ω3, ω4]^T  // 四个电机转速
```

### ArduCopter 控制架构

```
期望位置 → 位置控制器 → 期望姿态 → 姿态控制器 → 期望角速度 → 角速度控制器 → 电机输出
  │              │              │              │              │
  外环           └──────────────┴──────────────┴──────────────┘
                                    内环（级联控制）
```

---

*阶段 2 学习计划 - 创建于 2026-01-16*
