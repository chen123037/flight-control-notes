# 第三章实验总结

## 一、实现内容

根据《小型无人机理论与控制》第三章设计要求，用 Python 实现了 MAV 六自由度动力学仿真系统。

核心方程（式 3.14-3.17）：

| 方程 | 功能 |
|------|------|
| 平移运动学 | 位置微分：将机体速度转换为惯性系位置变化 |
| 平移动力学 | 速度微分：力产生加速度（含科里奥利项） |
| 姿态运动学 | 欧拉角微分：角速度到姿态角的映射 |
| 转动动力学 | 角速度微分：力矩产生角加速度（含 Γ 系数） |

---

## 二、创建的文件

本书小项目/
├── mav_params.py           # 参数配置（Zagi飞翼、无人机参数、Γ系数计算）
├── mav_dynamics.py         # 六自由度动力学方程实现
├── mav_simulation.py       # 仿真主程序 + 3D可视化动画
├── mav_verification.py     # 验证测试（力/力矩响应、耦合验证）
├── test_heading.py         # 机头朝向测试（偏航/滚转/俯仰）
├── debug_heading.py        # 调试脚本（俯视图、旋转矩阵检查）
└── equations_and_parameters.md  # 公式和参数文档

---

## 三、遇到的问题与解决

问题：3D 模型扁平扭曲  
原因：飞机几何顶点定义错误，机头放在了 x 负方向  
解决方案：重新定义顶点：机头在 x 正方向，机尾在 x 负方向  

问题：机头方向反向  
原因：同上  
解决方案：修正 `_build_vertices()` 函数  

问题：坐标轴比例失调  
原因：matplotlib 3D 默认不保持比例  
解决方案：添加 `ax.set_box_aspect([1,1,1])`  

问题：误以为“飞控失效”  
原因：测试是开环系统，没有控制器  
解决方案：理解：发散是正确的物理行为，飞控是后续章节内容  

问题：误以为“机头不指向飞行方向”  
原因：角速度太大（6秒转5圈），位移太小，视觉上像原地自转  
解决方案：通过旋转矩阵数学验证，确认机头与速度方向一致  

---

## 四、验证结果

1. 力响应测试（mav_verification.py 选项 1-3）

| 输入 | 预期 | 结果 |
|------|------|------|
| fx > 0 | u 增加，向北加速 | ✓ 正确 |
| fy > 0 | v 增加，向东侧滑 | ✓ 正确 |
| fz < 0 | w 减小（负），高度增加 | ✓ 正确 |

2. 力矩响应测试（选项 4-6）

| 输入 | 预期 | 结果 |
|------|------|------|
| l > 0 | 向右滚转，φ 增加 | ✓ 正确 |
| m > 0 | 抬头，θ 增加 | ✓ 正确 |
| n > 0 | 向右偏航，ψ 增加 | ✓ 正确 |

3. 滚转-偏航耦合验证（选项 7）

| 条件 | 预期 | 结果 |
|------|------|------|
| Jxz = 0 | 滚转和偏航无耦合 | ✓ 正确 |
| Jxz ≠ 0 | 滚转和偏航有耦合 | ✓ 正确 |

4. 旋转矩阵验证（debug_heading.py）  
psi = 0°/45°/90°/180° → 机头与速度方向一致 ✓

5. 3D 动画验证（mav_simulation.py）
- 飞机模型立体正常 ✓  
- 机头指向飞行方向 ✓  
- 重力作用下下沉 ✓  

---

## 五、关键理解

1. 本章是开环系统：没有飞控、没有 PID、没有阻尼，发散是正确行为  
2. NED 坐标系：z 轴向下为正，所以高度增加时 pd 减小，w 为负表示向上  
3. Jxz 耦合：惯性积导致滚转和偏航相互影响，是飞控必须处理的问题  
4. 气动力是后续内容：第四章会实现气动力模型，届时飞机会有阻尼  

---

## 六、运行命令汇总

```
# 参数模块测试
python mav_params.py

# 动力学模块测试
python mav_dynamics.py

# 完整仿真（3D动画）
python mav_simulation.py

# 交互式验证测试
python mav_verification.py

# 机头朝向调试
python debug_heading.py
```
