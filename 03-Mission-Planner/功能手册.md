# Mission Planner 功能手册

## 第1章 环境准备与启动

### 1.1 启动 SITL（WSL）

**前置条件**：已在 WSL 中完成 ArduPilot 环境配置与编译。

**步骤**：
1. 在项目目录打开终端，进入 WSL：
   - `wsl -d Ubuntu-22.04`
2. 进入 ArduPilot 目录：
   - `cd ~/ardupilot`
3. 启动 SITL：
   - `sim_vehicle.py -v ArduPlane --console --map`
4. 成功标志：
   - 会弹出三个窗口：`console` / `map` / `ArduPlane`

**截图**：
![SITL 启动窗口](./SITL启动截图.png)

### 1.2 Mission Planner 连接 SITL

**连接方式**：UDP  
**默认端口**：14550  

**步骤**：
1. 启动 Mission Planner
2. 等待自动连接（SITL 启动后会自动广播）

**连接成功标志**：
- 右上角显示：`UDP 115200`
- 右上角显示：`UDP14550-1-FIXED WING`

**截图**：
![Mission Planner 连接成功](./mission%20planner连接成功截图.png)

---

## 第2章 Flight Data 界面详解
本章对应 `FLIGHT DATA` 页签，是飞行状态与基础操作的总览页面。

### 2.1 界面分区速览

- 左侧 HUD（姿态仪）：显示姿态、航向、空速/地速、电池、模式与告警  
- 中间地图区：当前位置、航向箭头、围栏/禁飞区显示  
- 左下数据卡片：高度、地速、航点距离、偏航、升降速度等  
- 下方功能页签：快速/动作/消息/起飞前检查/仪表/Transponder/状态/舵机/Aux Function/脚本/Payload/日志

### 2.2 HUD 重点含义

- 蓝天/绿地分界线：地平线  
- 红色飞机符号：当前机体姿态  
- 红字提示：告警或前置条件未满足（如需重启、未校准等）  
- 模式显示：当前飞行模式（如 Manual）

### 2.3 下方页签要点

- **快速**：六个数据卡片（高度、地速、航点距离、偏航、升降速度、DistToMAV）  
- **动作**：常用操作按钮  
  - 包含：执行动作、自动、设置航点、手动、设置模式、返航、原始传感器校准、设置载荷、游戏摇杆、解锁/锁定、清除轨迹、恢复任务、Abort Landing 等  
- **消息**：系统日志与告警  
- **起飞前检查**：检查清单  
  - Verify GPS：GPS 检查  
  - GPS Sat Count：GPS 卫星数量  
  - Telemetry Signal：遥测信号  
  - Battery Level：电池电压  
  - Mode：当前模式  
  - Check Altitude：高度检查  
  - Tail and wings secured?：尾翼和机翼是否固定  
  - All servos respond to input?：舵机是否响应输入  
  - All servos respond to pitch and roll?：舵机是否响应俯仰/滚转  
  - Center of gravity at indicated：重心是否在标示位置  
  - Servo linkages are secure?：舵机连杆是否牢固  
  - Camera is on and ready to fly?：相机是否开启且准备就绪  
- **仪表**：指针式仪表视图  
  - 四个仪表盘：VSI（升降速率）、Speed（空速）、Alt（高度）、航向罗盘  
- **Transponder**：应答机相关设置  
  - 作用：与空管/周边飞机交换识别与位置（有硬件才用）  
  - 常见项：Squawk（应答机编码）、STBY/ON/ALT（待机/开启/高度报告）、IDENT（识别）  
- **状态**：传感器/变量列表  
- **舵机**：输出通道条  
  - 左侧为遥控输入，右侧为舵机/电机输出  
- **Aux Function**：辅助功能开关  
  - 含义：把遥控开关档位（Low/Mid/High）绑定到一个功能动作  
  - 用法：左侧下拉选择功能，右侧为各档位分配动作  
- **脚本**：脚本管理  
- **Payload**：载荷控制  
- **遥测日志/数据闪存日志**：日志回放与下载

### 2.4 学习要点（SITL）

- 认识 HUD、地图、数据卡片三块区域  
- 查看“消息”和“起飞前检查”页签  
- 观察状态行与红字提示即可，无需实际起飞

## 第3章 航线规划指南

### 3.1 前置条件

- SITL 已启动（`sim_vehicle.py -v ArduPlane --console --map`）
- Mission Planner 已连接（右上角显示 `UDP 115200` 与 `UDP14550-1-FIXED WING`）

### 3.2 进入 Flight Plan 界面

顶部菜单点击 `FLIGHT PLAN` 进入航线规划界面。

界面主要区域：
- 地图区：中央地图，点击可添加航点
- 航点列表：下方表格区域，显示航点序号、经纬度、高度等
- 右侧工具区：常用按钮（`加载航点文件` / `保存航点文件` / `读取航点` / `写入航点` / `Write Fast`）
- 命令选择：下方表格中的 `命令` 列，用于选择航点类型

### 3.3 航点基本操作

**添加航点**  
- 在地图上左键点击：自动添加一个航点（默认 `WAYPOINT`）
- 航点会按顺序编号（0, 1, 2...）
- 航点 0 通常为 HOME 点

**移动航点**  
- 在地图上拖拽航点标记即可移动位置

**删除航点**  
- 在航点列表中选中航点行后删除

**修改参数**  
- 在航点列表中直接编辑高度、经纬度等参数

### 3.4 常用航点命令

- `WAYPOINT`：普通航点  
- `TAKEOFF`：起飞（固定翼需设定起飞高度）  
- `LOITER_TURNS`：盘旋指定圈数  
- `LOITER_TIME`：盘旋指定时间  
- `LOITER_UNLIM`：无限盘旋  
- `RETURN_TO_LAUNCH`（RTL）：返航  
- `LAND`：降落  

### 3.5 练习：创建一条简单航线

1. 清除现有航点：点击 `清除航点`
2. 确认 HOME 点：  
   - 连接后地图已有 HOME 点（示例高度约 587）  
   - 起飞位置就是 HOME 点，不需要另选位置  
3. 设置起飞点（TAKEOFF）：  
   - 选中第一个任务点（WP1），把命令改为 `TAKEOFF`  
   - 起飞位置使用 HOME 点（与飞机当前位置一致）  
   - 高度设为 50（可按需要调整）  
4. 添加 3 个航点：  
   - 继续点击地图添加 3 点  
   - 高度设为 80  
5. 添加盘旋点：  
   - 命令选择 `LOITER_TURNS`  
   - 圈数设为 2  
   - 高度设为 80  
6. 添加返航点：  
   - 命令选择 `RETURN_TO_LAUNCH`（RTL）  
   - 返航点坐标不会被用作目标点，实际会回到 HOME  

### 3.6 保存与上传航线

- `写入航点`：把当前航线写入飞控（SITL）
- `读取航点`：从飞控读取航线（会提示清空本地当前航点列表，确认后才读取）
- `保存航点文件`：保存为本地航线文件
- `加载航点文件`：从本地文件加载航线

建议将航线文件保存至：`docs/06-实践记录/SITL/`

### 3.7 航点表格字段说明

- `Acc radius`：到达航点的接受半径（进入该半径即认为到达）
- `Pass by dist`：掠过距离（通过而不精确到点的偏移距离）
- `Lat / Long`：航点经纬度
- `Alt (m)`：航点高度（米）
- `Frame`：高度参考系  
  - `Relative`：相对 HOME  
  - `Absolute`：相对海平面  
  - `Terrain`：相对地形
- `坡度`：相邻航点高度差与水平距离计算得到的航段坡度（不是俯仰角）
- `Angle`：相邻航段的转向角（航线夹角）
- `距离`：相邻航点间水平距离
- `方位角`：从当前航点指向下一个航点的地面航向角（不是偏航角）

### 3.8 常见命令说明（节选）

以下是任务列表中常见命令的简要说明：
- `RETURN_TO_LAUNCH`：返航回 HOME  
- `LOITER_TURNS`：按圈数盘旋  
- `LOITER_TIME`：按时间盘旋  
- `LOITER_UNLIM`：无限盘旋  
- `TAKEOFF`：起飞  
- `LAND`：降落  
- `DO_CHANGE_SPEED`：改变速度  
- `DO_SET_HOME`：设置 HOME  
- `DO_JUMP`：跳转到指定任务序号  

### 3.10 命令清单（参考）

- `WAYPOINT`：普通航点  
- `LOITER_UNLIM`：无限盘旋  
- `LOITER_TURNS`：按圈数盘旋  
- `LOITER_TIME`：按时间盘旋  
- `LOITER_TO_ALT`：盘旋并爬升/下降到指定高度  
- `RETURN_TO_LAUNCH`：返航（RTL）  
- `LAND`：降落  
- `TAKEOFF`：起飞  
- `DELAY` / `CONDITION_DELAY`：等待一段时间  
- `CONDITION_DISTANCE`：满足距离条件后继续  
- `CONDITION_YAW`：满足航向/偏航条件后继续  
- `DO_GRIPPER`：夹爪控制  
- `DO_LAND_START`：开始降落流程  
- `DO_SET_ROI`：设置兴趣点  
- `DO_SET_ROI_LOCATION`：设置兴趣点坐标  
- `DO_SET_ROI_NONE`：清除兴趣点  
- `DO_INVERTED_FLIGHT`：倒飞（固定翼）  
- `DO_SET_CAM_TRIGG_DIST`：按距离触发相机  
- `DO_JUMP`：跳转到指定任务序号  
- `JUMP_TAG` / `DO_JUMP_TAG`：带标签的跳转控制  
- `DO_CHANGE_SPEED`：改变速度  
- `DO_SET_HOME`：设置 HOME 点  
- `DO_SET_RELAY` / `DO_REPEAT_RELAY`：继电器控制/重复  
- `DO_SET_SERVO` / `DO_REPEAT_SERVO`：舵机控制/重复  
- `DO_DIGICAM_CONFIGURE`：相机参数配置  
- `DO_DIGICAM_CONTROL`：相机控制  
- `DO_MOUNT_CONTROL`：云台控制  
- `DO_GIMBAL_MANAGER_PITCHYAW`：云台俯仰/偏航控制  
- `DO_PARACHUTE`：降落伞控制  
- `DO_FENCE_ENABLE`：启用/禁用围栏  
- `DO_SPRAYER`：喷洒装置控制  
- `DO_AUTOTUNE_ENABLE`：自动调参开关  
- `DO_ENGINE_CONTROL`：发动机控制  
- `DO_SET_RESUME_REPEAT_DIST`：设置重复/恢复距离  
- `VTOL_TAKEOFF`：垂直起飞  
- `VTOL_LAND`：垂直降落  
- `PAYLOAD_PLACE`：投放载荷  
- `SCRIPT_TIME`：脚本延时/时间控制  
- `DO_SEND_SCRIPT_MESSAGE`：发送脚本消息  
- `DO_VTOL_TRANSITION`：VTOL 模式转换  
- `IMAGE_START_CAPTURE` / `IMAGE_STOP_CAPTURE`：开始/停止拍照  
- `SET_CAMERA_ZOOM` / `SET_CAMERA_FOCUS` / `SET_CAMERA_SOURCE`：相机变焦/对焦/信号源  
- `VIDEO_START_CAPTURE` / `VIDEO_STOP_CAPTURE`：开始/停止录像  
- `DO_AUX_FUNCTION`：辅助功能通道控制  
- `ALTITUDE_WAIT`：高度等待  
- `CONTINUE_AND_CHANGE_ALT`：继续并改变高度  
- `UNKNOWN`：未知/不支持的命令  

### 3.9 常见现象说明

- **HOME 与任务航线之间是虚线**：HOME 点不是任务航点，Mission Planner 常用虚线表示 HOME 与第一个任务点或返航路径的示意线，不代表已规划的任务航段。  
- **RTL 行为**：`RETURN_TO_LAUNCH` 执行时会从当前位置直接返航到 HOME，其经纬度列不会作为目标点使用。  

### 3.11 围栏（Fence）设置与作用

**作用**：  
围栏用于限定飞机允许飞行的区域（Inclusion）或禁止进入的区域（Exclusion），避免飞出规定范围或进入危险区。

**入口**：  
在 Flight Plan 右上角下拉选择 `FENCE`。

**基本设置步骤**：
1. 切换到 `FENCE` 模式  
2. 使用绘制工具画区域（多边形或圆形）  
3. 选择类型：  
   - `FENCE_POLYGON_VERTEX_INCLUSION`（允许区）  
   - `FENCE_POLYGON_VERTEX_EXCLUSION`（禁入区）  
4. 写入围栏到飞控（使其生效）  
5. 可选：保存围栏文件以便复用  

**截图**：  
![设置 FENCE 围栏](./设置FENCE围栏.png)

## 第4章 初始设置与校准
本章对应 `INITIAL SETUP` 页签下的常见入口与校准流程。

### 4.1 Install Firmware（固件安装）

**入口**：`INITIAL SETUP` → `Install Firmware`  

**作用**：为飞控写入对应机型固件。  

**步骤**：
1. SITL 学习：无需刷固件，跳过此步  
2. 真机刷写：先断开连接，再选择与机型匹配的固件类型  
3. 等待写入完成并自动重启，完成后重新连接  

**记录要点**：固件类型、版本号、是否成功重启。

### 4.2 Frame Type（机架类型）

**入口**：`INITIAL SETUP` → `Frame Type`  

**作用**：选择与实际机架一致的类型，影响混控与姿态控制。  

**步骤**：
1. 固定翼（Plane）：此项通常不显示，可跳过  
2. 旋翼（Copter）：在列表中选择对应机架并保存配置  

**记录要点**：机架名称、示意图/配置截图。

### 4.3 Accelerometer Calibration（加速度计校准）

**入口**：`INITIAL SETUP` → `Accel Calibration`  

**作用**：校准水平与六面姿态，提升姿态解算精度。  

**步骤**：
1. 按提示依次放置六个姿态面（真实机体）  
2. 每次放稳后点击下一步  
3. 完成后确认校准结果  
4. SITL 学习：无法翻转机体时可出现失败提示，属于正常现象  

**记录要点**：是否通过、是否提示异常。

**常见报错与原因**：  
- `Calibration FAILED`：未按提示完成六面姿态或 SITL 无实体传感器  
- `PreArm: 3D Accel calibration needed`：加速度计未完成校准  

**正常情况下该如何操作**：  
- 确保机体静止、逐面放置完成六面校准  
- 校准完成后报错应消失，再进行下一项校准

### 4.4 Compass（罗盘设置与校准）

**入口**：`INITIAL SETUP` → `Compass`  

**作用**：配置与校准内置/外置罗盘，保证航向准确。  

**界面分区说明**：  
- 上方表格：罗盘列表与优先级（Priority 越小越优先）；Bus/DevType 为硬件类型；External 表示外置罗盘；Orientation 为安装方向；右侧上下箭头可调整优先级  
- 中间勾选：Use Compass 1/2/3 选择启用哪些罗盘；调整优先级后需重启  
- 下方校准区：Onboard Mag Calibration，点 Start 开始校准；Mag1/2/3 显示校准结果；Fitness 为拟合质量  

**步骤**：
1. 按需选择要启用的罗盘  
2. 点击 Start 开始校准  
3. 按提示旋转机体完成采样  
4. 结束后查看干扰值与罗盘状态  

**SITL 说明**：可直接跳过；想体验流程仅点 Start 按提示即可  

**记录要点**：罗盘数量、干扰值、是否启用外置罗盘。

### 4.5 Radio Calibration（遥控器校准）

**入口**：`INITIAL SETUP` → `Radio Calibration`  

**作用**：校准通道行程与中位，确保控制输入正确。  

**界面说明**：  
- 左侧四个主通道：Roll/Pitch/Throttle/Yaw 的输入条  
- 右侧 Radio 5~16：辅助通道与开关输入  
- “反转”勾选：通道方向反转  
- “校准遥控”按钮：开始校准流程  

**步骤**：
1. 点击“校准遥控”进入校准流程  
   - 提示会要求确认遥控器已开机、接收机已上电并连接  
   - 安全提醒：电机断电、螺旋桨拆下  
2. 按提示打满各通道并回中  
   - 点击 OK 后，将所有摇杆/开关打到最大与最小位置，使红色条到两端  
3. 完成时会提示回中与油门最低  
   - 确保所有摇杆回中、油门最低后点 OK  
4. 随后会显示通道检测结果与范围说明  
   - 正常范围约 1100~1900  
   - 未连接通道会显示 1500  
5. 检查通道顺序与反向是否正确  
6. 保存校准结果  

**SITL 说明**：无真实遥控时通道值可能不动，可跳过或仅体验流程。  

**记录要点**：通道映射、反向设置、是否正常回中。

### 4.6 Flight Modes（飞行模式设置）

**入口**：`INITIAL SETUP` → `Flight Modes`  

**作用**：给遥控器模式开关分配飞行模式。  

**界面说明**：  
- 左侧“飞行模式 1~6”：对应模式开关的 6 个档位  
- 下拉框：为每个档位选择具体模式  
- 顶部“当前模式”：当前实际生效的模式  
- 右侧 PWM 区间：遥控开关输入对应的脉宽范围  
- “保存模式”：保存当前配置  

**步骤**：
1. 为各档位选择模式  
2. 保存设置  
3. 拨动开关确认界面显示切换  

**SITL 说明**：无真实开关输入时可保持默认，仅体验保存流程。  

**常用模式速记（固定翼）**：  
- Manual：纯手动，姿态与油门完全由遥控输入控制  
- Stabilize：自稳，遥控控制滚转/俯仰/油门，系统保持姿态  
- FBWA：姿态辅助，遥控给目标姿态/坡度，系统限幅并稳定飞行  
- Auto：全自动执行任务航线  
- RTL：返航回 HOME 点  
- Loiter：定点盘旋  

**记录要点**：模式顺序、对应用途。

### 4.7 Servo Output（舵机/电机输出）

**入口**：`INITIAL SETUP` → `Servo Output`  

**作用**：设置各输出通道的功能与行程范围。  

**界面说明**：  
- `Function`：该通道绑定的功能（如 Aileron/Elevator/Throttle/Rudder）  
- `Reverse`：输出方向反转  
- `Min/Trim/Max`：输出最小/中位/最大 PWM  

**SITL 说明**：建议不改动，仅了解通道与功能的对应关系。  

### 4.8 Serial Ports（串口配置）

**入口**：`INITIAL SETUP` → `Serial Ports`  

**作用**：配置各串口波特率与协议（如 MAVLink/GPS）。  

**界面说明**：  
- `Speed`：串口波特率  
- `Protocol`：串口用途  
- 右侧 `Set Bitmask`：高级选项设置  
- 底部提示：修改后需重启才生效  

**SITL 说明**：默认配置即可，不建议修改。  

### 4.9 ESC Calibration（电调校准）

**入口**：`INITIAL SETUP` → `ESC Calibration`  

**作用**：校准电调的油门行程。  

**界面说明**：  
- 页面说明中包含完整步骤提示  
- `Start` 按钮：开始校准流程  

**安全提醒**：电机断电、螺旋桨拆下。  

**SITL 说明**：仿真不需要电调校准，可跳过。  

### 4.10 Failsafe（故障保护）

**入口**：`INITIAL SETUP` → `故障保护`  

**作用**：设置遥控/电池/地面站等失效时的保护行为。  

**界面说明**：  
- 左侧：遥控输入与舵机/电机输出条  
- 右侧：电池、地面站与故障保护相关配置  

**SITL 说明**：了解有哪些保护项即可，暂不修改。  

### 4.11 HW ID（硬件识别）

**入口**：`INITIAL SETUP` → `HW ID`  

**作用**：查看已识别硬件与设备 ID（传感器/总线）。  

**SITL 说明**：仅查看，不需要改动参数。  

### 4.12 ADSB

**入口**：`INITIAL SETUP` → `ADSB`  

**作用**：配置 ADS-B 接收/避让相关参数。  

**SITL 说明**：无 ADS-B 硬件时保持 `Disabled`。  

### 4.13 基础检查清单

- 姿态显示方向与机体一致  
  - 入口：`FLIGHT DATA` 左侧 HUD  
  - 方法：观察“蓝天/绿地”地平线与红色飞机符号，滚转/俯仰变化时地平线应随之倾斜或上下移动  
- 传感器状态正常  
  - 入口：`FLIGHT DATA` HUD 下方状态行  
  - 查看：`EKF / INS / MAG / GPS` 是否为正常/OK（红字为告警）  
- 若出现异常，返回相应校准页复核  
  - `INITIAL SETUP` → `Accel Calibration` / `Compass` / `Radio Calibration`

### 4.14 未学习项说明（暂不展开）

- 可选硬件：传感器与外设类（电台/电池监测/声呐等）暂不展开  
- Advanced：高级功能暂不展开，仅了解存在即可

## 第5章 参数配置界面

### 5.1 参数列表截图

![参数列表截图](./航线计划%20参数列表.png)

## 第6章 实战：完整航线任务
（待补充）

## 附录：常用快捷键/常见问题
（待补充）

## 附录：PWM 基础说明

**一句话概念**：PWM 是用“脉冲宽度”表示控制量大小的信号。  

**常见范围**：1000~2000（中位约 1500）。  

**两类使用场景**：  
- 遥控输入 PWM：来自接收机，用来判断摇杆位置与开关档位  
- 舵机/电机输出 PWM：飞控输出给舵机/电调，控制舵面偏角与油门大小  

**在 Mission Planner 的使用位置**：  
- `Radio Calibration`：读取输入 PWM，确定通道范围与方向  
- `Flight Modes`：用输入 PWM 区间选择飞行模式  
- `Servo Output`：设置输出 PWM 的 Min/Trim/Max  
- `Failsafe`：用 PWM 阈值判定失控并触发保护  

**SITL 说明**：无真实遥控输入时，PWM 可能固定不变，属于正常现象。
