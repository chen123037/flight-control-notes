## 第9章 导航参数实战指南（L1 控制器）

本章目标：在 SITL 中理解 L1 导航控制器的“转弯响应、盘旋半径、到达判定”，并完成可复现的对照实验记录。

### 9.1 原理速览（只记 4 句）
1. L1 控制器通过“期望航向变化率”来指挥滚转，滚转大小决定转弯半径。
2. `NAVL1_PERIOD` 越小越“灵敏”，转弯更紧但更容易过冲；越大越“稳”，转弯半径更大。
3. `NAVL1_DAMPING` 越大越平滑，越小越敏捷但易振荡。
4. `WP_RADIUS` 控制“何时判定到达航点”，`WP_LOITER_RAD` 控制盘旋半径；`LIM_ROLL_CD` 限制最大滚转角。

### 9.2 实验前准备
1. **备份参数**：`CONFIG` → `Full Parameter List` → `Save to File`。
2. **开启 Tuning**：`FLIGHT DATA` → 勾选 `Tuning` → 双击波形窗口，建议勾选：
   - `roll`、`nav_roll`
   - `groundspeed` 或 `airspeed`
   - `wp_dist`（若无此项，至少保留 `roll/nav_roll`）
3. **基线记录**：不改参数先飞一遍，记录转弯半径、是否过冲、盘旋半径是否稳定。

**基线记录（截图读数）**：
- 盘旋1：roll 36.94~44.76（均值 40.65）；nav_roll 37.01~44.97（均值 40.75）；
  groundspeed 23.47~23.91（均值 23.63）；airspeed 22.05~22.42（均值 22.17）；
  wp_dist 87~99（均值 96.72）
- 盘旋2：roll 37.69~38.30（均值 37.98）；nav_roll 37.81~38.35（均值 38.08）；
  groundspeed 23.42~23.51（均值 23.45）；airspeed 21.96~22.06（均值 22.01）；
  wp_dist 96~96（均值 96）
- 转弯1：roll -40.71~0.46（均值 -13.08）；nav_roll -36.39~0.58（均值 -13.25）；
  groundspeed 23.37~23.90（均值 23.54）；airspeed 21.95~22.39（均值 22.10）；
  wp_dist 24~962（均值 673.99）
- 转弯2：roll -56.27~0.22（均值 -26.71）；nav_roll -51.81~0.14（均值 -28.26）；
  groundspeed 23.02~24.52（均值 23.54）；airspeed 21.71~23.13（均值 22.19）；
  wp_dist 53~733（均值 602.10）
- 转弯3：roll -47.24~0.26（均值 -16.59）；nav_roll -43.25~0.18（均值 -18.07）；
  groundspeed 23.37~24.04（均值 23.56）；airspeed 21.95~22.59（均值 22.14）；
  wp_dist 29~1069（均值 620.77）

**基线结论**：
- 盘旋段 `roll` 与 `nav_roll` 贴合，跟随稳定，空速/地速波动很小。
- 转弯段 `roll/nav_roll` 方向一致且幅值接近，转弯响应正常。
- `wp_dist` 在切航段时出现阶跃与回落，符合航点切换与转弯过程特征。

**基线结论释义**：
- **盘旋段**：`nav_roll` 是期望滚转角，`roll` 是实际滚转角，二者贴合说明姿态跟随准确；
  空速/地速波动小，表示动力与阻力在盘旋中保持平衡，速度稳定。
- **转弯段**：`roll` 与 `nav_roll` 同向且幅值接近，说明转弯幅度能跟上指令，
  未出现过冲或明显不足，属于正常响应。
- **`wp_dist` 阶跃与回落**：`wp_dist` 是到“当前目标航点”的距离。
  盘旋结束切换航点时，目标突然变远 → 距离出现阶跃；开始飞向新航点 → 距离持续回落。
  这正是航点切换与转弯过程的正常表现。

### 9.3 航线规划（需含急转弯与盘旋）
建议使用等高航线，避免高度控制影响导航判断：
1. `TAKEOFF`：50 m
2. 航点 1：高度 50 m，直飞 300~500 m
3. 航点 2：高度 50 m，设置 90° 或 120° 急转
4. 航点 3：高度 50 m
5. `LOITER`：2 圈（高度 50 m）
6. `LAND`：0 m

### 9.4 关键参数与实验步骤
**参数一：`NAVL1_PERIOD`（L1 周期）**
1. 记录默认值（通常 15 s）。
2. 试验 A：改小（例如 10 s），写入并飞行。
   - 观察：转弯半径变小但容易过冲、滚转指令更猛。
3. 试验 B：改大（例如 20 s），写入并飞行。
   - 观察：转弯半径变大，轨迹更平滑但跟随变慢。

**参数一记录（A/B 对照）**：
- 试验 A（NAVL1_PERIOD=10）：
  - 盘旋1：roll 38.15~40.22（均值 39.34）；nav_roll 38.35~40.24（均值 39.48）；
    groundspeed 23.32~23.49（均值 23.42）；airspeed 21.92~22.11（均值 22.05）；
    wp_dist 90~90（均值 90）
  - 盘旋2：roll 39.29~40.18（均值 39.69）；nav_roll 39.52~40.17（均值 39.78）；
    groundspeed 23.36~23.43（均值 23.38）；airspeed 21.97~22.06（均值 22.01）；
    wp_dist 90~90（均值 90）
  - 转弯1：roll -69.17~0.13（均值 -37.56）；nav_roll -64.99~0.04（均值 -40.71）；
    groundspeed 21.6~25.2（均值 23.76）；airspeed 20.76~23.85（均值 22.44）；
    wp_dist 54~844（均值 579.13）
  - 转弯2：roll -54.82~0.03（均值 -13.13）；nav_roll -51.55~0.01（均值 -14.67）；
    groundspeed 22.93~24.51（均值 23.41）；airspeed 21.59~23.06（均值 22.07）；
    wp_dist 27~1296（均值 720.33）
  - 结论：滚转响应更灵敏，转弯更紧，wp_dist 变化更快；与基线相比转弯更激进。
- 试验 B（NAVL1_PERIOD=20）：
  - 盘旋1：roll 34.69~39.93（均值 36.5）；nav_roll 34.79~39.85（均值 36.46）；
    groundspeed 23.29~23.42（均值 23.36）；airspeed 21.92~22.08（均值 21.99）；
    wp_dist 104~107（均值 106.13）
  - 盘旋2：roll 35.71~36.03（均值 35.85）；nav_roll 35.8~36.08（均值 35.96）；
    groundspeed 23.33~23.38（均值 23.36）；airspeed 21.93~22.04（均值 21.99）；
    wp_dist 103~103（均值 103）
  - 转弯1：roll -52.46~0.28（均值 -22.78）；nav_roll -49.78~0.3（均值 -25.26）；
    groundspeed 23.37~24.51（均值 23.75）；airspeed 21.97~23.08（均值 22.36）；
    wp_dist 55~854（均值 484.28）
  - 转弯2：roll -39.27~0.11（均值 -14.73）；nav_roll -34.62~0.08（均值 -15.5）；
    groundspeed 23.29~23.76（均值 23.45）；airspeed 21.94~22.33（均值 22.08）；
    wp_dist 28~1299（均值 805.19）
  - 结论：滚转更平滑，转弯半径偏大，整体响应更稳；与基线相比转弯更保守。

**参数二：`NAVL1_DAMPING`（L1 阻尼）**
1. 记录默认值（通常 0.75）。
2. 试验 A：改小（例如 0.6）。
   - 观察：转弯响应更敏捷，但更容易振荡或过冲。
3. 试验 B：改大（例如 0.9）。
   - 观察：滚转变化更平滑，转弯更稳但反应更慢。

**参数二记录（A/B 对照）**：
- 试验 A（NAVL1_DAMPING=0.6）：
  - 盘旋1：roll 35.04~46.18（均值 38.84）；nav_roll 35.11~45.92（均值 38.66）；
    groundspeed 23.37~23.76（均值 23.5）；airspeed 21.96~22.37（均值 22.12）；
    wp_dist 94~105（均值 100.7）
  - 盘旋2：roll 37.66~38.09（均值 37.89）；nav_roll 37.79~38.18（均值 37.99）；
    groundspeed 23.36~23.45（均值 23.39）；airspeed 21.96~22.08（均值 22.01）；
    wp_dist 96~96（均值 96）
  - 转弯1：roll -54.91~-0.06（均值 -35.57）；nav_roll -51.63~-0.1（均值 -37.54）；
    groundspeed 23.38~24.64（均值 23.92）；airspeed 21.96~23.21（均值 22.53）；
    wp_dist 57~852（均值 662.43）
  - 转弯2：roll -39.43~0.48（均值 -16.2）；nav_roll -34.64~0.46（均值 -17.29）；
    groundspeed 23.23~23.78（均值 23.47）；airspeed 21.91~22.42（均值 22.09）；
    wp_dist 30~1297（均值 813.61）
  - 结论：滚转波动略大，响应更敏捷；与基线相比更容易出现波动。
- 试验 B（NAVL1_DAMPING=0.9）：
  - 盘旋1：roll 37.28~41.43（均值 38.46）；nav_roll 37.45~41.36（均值 38.49）；
    groundspeed 23.3~23.5（均值 23.37）；airspeed 21.92~22.12（均值 22.0）；
    wp_dist 94~97（均值 96.08）
  - 盘旋2：roll 37.5~37.94（均值 37.72）；nav_roll 37.6~38（均值 37.84）；
    groundspeed 23.31~23.37（均值 23.35）；airspeed 21.94~22.03（均值 21.99）；
    wp_dist 96~96（均值 96）
  - 转弯1：roll -65.14~0.36（均值 -33.58）；nav_roll -63.65~0.3（均值 -36.23）；
    groundspeed 23.34~26.15（均值 24.09）；airspeed 21.93~24.85（均值 22.74）；
    wp_dist 55~845（均值 554.54）
  - 转弯2：roll -51.42~0.51（均值 -12.52）；nav_roll -47.94~0.4（均值 -14.4）；
    groundspeed 23.19~24.27（均值 23.51）；airspeed 21.84~22.84（均值 22.11）；
    wp_dist 28~1296（均值 613.23）
  - 结论：滚转更平滑、跟随更稳；与基线相比更保守。

**参数三：`WP_LOITER_RAD`（盘旋半径）**
1. 记录默认值（你当前为 80 m）。
2. 试验 A：改小（例如 50 m）。
   - 观察：盘旋圈更小，但可能出现滚转过大或轨迹不稳定。
3. 试验 B：改大（例如 100 m）。
   - 观察：盘旋圈更大，轨迹更平滑。

**参数三记录（A/B 对照）**：
- 试验 A（WP_LOITER_RAD=50）：
  - 盘旋1：roll 45.96~55.83（均值 52.29）；nav_roll 45.88~56.06（均值 52.33）；
    groundspeed 23.45~24.65（均值 23.93）；airspeed 22.1~23.24（均值 22.55）；
    wp_dist 45~74（均值 64.92）
  - 盘旋2：roll 47.04~48.02（均值 47.59）；nav_roll 47.24~48.07（均值 47.64）；
    groundspeed 23.34~23.53（均值 23.44）；airspeed 21.99~22.18（均值 22.07）；
    wp_dist 68~69（均值 68.56）
  - 转弯1：roll -60.45~0.18（均值 -22）；nav_roll -58.3~0.11（均值 -24.93）；
    groundspeed 23.37~25.28（均值 23.87）；airspeed 21.96~23.88（均值 22.46）；
    wp_dist 59~845（均值 427.64）
  - 转弯2：roll -46.02~0.13（均值 -15.68）；nav_roll -41.73~0.04（均值 -16.28）；
    groundspeed 23.12~24.00（均值 23.45）；airspeed 21.78~22.54（均值 22.08）；
    wp_dist 32~1300（均值 848.01）
  - 结论：盘旋半径变小，滚转角增大；与基线相比盘旋更紧、更“激进”。
- 试验 B（WP_LOITER_RAD=100）：
  - 盘旋1：roll 32.04~33.25（均值 32.61）；nav_roll 32.16~33.3（均值 32.72）；
    groundspeed 23.37~23.45（均值 23.39）；airspeed 21.96~22.09（均值 22.02）；
    wp_dist 115~116（均值 115.13）
  - 盘旋2：roll 32.53~33.14（均值 32.91）；nav_roll 32.71~33.16（均值 33）；
    groundspeed 23.35~23.47（均值 23.4）；airspeed 21.95~22.06（均值 22.01）；
    wp_dist 115~115（均值 115）
  - 转弯1：roll -60.48~0.17（均值 -31.6）；nav_roll -58.69~0.06（均值 -34.62）；
    groundspeed 23.36~25.32（均值 24.00）；airspeed 21.96~23.92（均值 22.62）；
    wp_dist 54~846（均值 541.01）
  - 转弯2：roll -46.63~0.34（均值 -13.6）；nav_roll -42.3~0.23（均值 -14.52）；
    groundspeed 23.28~24.02（均值 23.49）；airspeed 21.91~22.57（均值 22.1）；
    wp_dist 31~1299（均值 668.75）
  - 结论：盘旋半径变大，滚转角减小；与基线相比盘旋更松、更平滑。

**参数四：`WP_RADIUS`（航点到达半径）**
1. 记录默认值（你当前为 50 m）。
2. 单次调整（例如 30 m 或 80 m），观察：
   - 半径变小：更贴近航点再转向，但更容易切不过去。
   - 半径变大：更早切航段，转弯更早更平滑。

**参数四记录（单次调整）**：
- 试验 B（WP_RADIUS=80）：
  - 盘旋1：roll 36.73~44.67（均值 39.85）；nav_roll 36.85~44.77（均值 39.84）；
    groundspeed 23.3~23.79（均值 23.39）；airspeed 21.91~22.38（均值 22.02）；
    wp_dist 91~99（均值 97.19）
  - 盘旋2：roll 37.57~38.03（均值 37.8）；nav_roll 37.73~38.08（均值 37.92）；
    groundspeed 23.33~23.42（均值 23.38）；airspeed 21.96~22.07（均值 22.01）；
    wp_dist 96~96（均值 96）
  - 转弯1：roll -60.62~0.11（均值 -44.63）；nav_roll -58.68~0.08（均值 -46.32）；
    groundspeed 22.97~25.43（均值 24.08）；airspeed 21.62~23.97（均值 22.7）；
    wp_dist 85~821（均值 769.01）
  - 转弯2：roll -39.7~0.32（均值 -13.36）；nav_roll -35.95~0.24（均值 -14）；
    groundspeed 23.32~23.8（均值 23.46）；airspeed 21.97~22.39（均值 22.09）；
    wp_dist 47~1310（均值 745.8）
  - 结论：航点到达半径变大后更早切航段，转弯更提前更平滑；与基线相比切换更早。

**参数五：`ROLL_LIMIT_DEG`（最大滚转角，等价于 `LIM_ROLL_CD`）**
1. 记录默认值（通常 65°）。
2. 可选试验：改小（例如 45°）。
   - 观察：转弯半径变大，过急转弯可能切不过去。

**参数五记录（单次调整）**：
- 试验（ROLL_LIMIT_DEG=45）：
  - 盘旋1：roll 37.69~38.22（均值 37.95）；nav_roll 37.82~38.25（均值 38.04）；
    groundspeed 23.37~23.45（均值 23.4）；airspeed 21.95~22.06（均值 22.01）；
    wp_dist 96~96（均值 96）
  - 转弯1：roll -49.15~-0.02（均值 -16.12）；nav_roll -44.99~-0.12（均值 -17.73）；
    groundspeed 23.35~24.25（均值 23.59）；airspeed 21.95~22.8（均值 22.2）；
    wp_dist 55~860（均值 420.97）
  - 结论：滚转被限制后转弯更保守、半径更大；与基线相比转弯更早变缓。

### 9.5 指标解读（如何从曲线与轨迹得结论）
1. **转弯半径**：地图轨迹圆弧越小 → 转弯更紧；越大 → 转弯更缓。
2. **跟随快慢**：`nav_roll` 上升快且峰值高 → 响应快；上升慢 → 跟随慢。
3. **过冲/振荡**：`roll` 反复越过 `nav_roll` 或出现波纹 → 振荡。
4. **盘旋半径**：`LOITER` 圈的直径变化最直观，必要时截图测距。

### 9.6 记录模板（直接复制）
```
日期：
航线：包含急转弯与盘旋
基线参数：NAVL1_PERIOD=__ / NAVL1_DAMPING=__ / WP_LOITER_RAD=__ / WP_RADIUS=__ / ROLL_LIMIT_DEG=__

试验 A（改动）：
- 参数与改动值：
- 现象（转弯半径、滚转峰值、是否过冲/振荡）：
- 结论：

试验 B（改动）：
- 参数与改动值：
- 现象：
- 结论：
```

### 9.7 截图清单（务必保留）
1. 航线规划界面（含急转弯与盘旋设置）
2. Tuning 波形（`roll/nav_roll`、`groundspeed`）
3. 地图轨迹（对比不同参数下的转弯半径与盘旋半径）

### 9.8 常见问题排查
- **转弯很早/很迟**：检查 `WP_RADIUS` 是否过大/过小。
- **转弯半径始终很大**：检查 `LIM_ROLL_CD` 是否限制过小，或 `NAVL1_PERIOD` 过大。
- **盘旋不圆**：检查 `WP_LOITER_RAD`、风速与空速变化，必要时保持等高等速。
- **曲线不明显**：确认 `AUTO` 模式执行航线，且 `Tuning` 勾选正确曲线。

### 9.9 实验结束与归档
1. 将参数恢复为基线或备份值。
2. 在周三记录中补齐“学习时长 / 完成情况 / 遇到问题”。
3. 将截图与调参日志存入本周记录目录。
